steps:

- template: install.yml

- bash: |
    source activate wradlib-tests
    export COVERAGE_PROCESS_START=$PWD/.coveragerc
    coverage run -m pytest --verbose --doctest-modules --durations=15 wradlib
    ls -lart
    coverage combine
    ls -lart
  displayName: Run tests

- bash: |
    source activate wradlib-tests
    ls -lart
    codecov -f coverage.xml -F wradlib_azure_tests
  env:
    CODECOV_TOKEN: $(codecov_token)
  displayName: Upload coverage to codecov.io

