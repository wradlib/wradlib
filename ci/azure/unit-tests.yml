steps:

- template: install.yml

- bash: |
    source activate wradlib-tests
    export COVERAGE_PROCESS_START=$PWD/.coveragerc
    pytest -n 2 --verbose --doctest-modules --durations=15 --cov-report xml:coverage.xml --cov=wradlib --pyargs wradlib
  displayName: Run tests

- bash: |
    source activate wradlib-tests
    codecov -f coverage.xml -F wradlib_azure_tests
  env:
    CODECOV_TOKEN: $(codecov_token)
  displayName: Upload coverage to codecov.io

